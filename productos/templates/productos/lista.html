{% extends 'productos/base.html' %}

{% block content %}
<h1>Productos</h1>

<!-- Buscador y filtro por categoría -->
<form method="get" class="filtros">
    <input type="text" name="q" placeholder="Buscar producto..." value="{{ request.GET.q|default:'' }}">
    
    <select name="categoria">
        <option value="">Todas las categorías</option>
        {% for cat in categorias %}
            <option value="{{ cat.id }}" {% if request.GET.categoria == cat.id|stringformat:"s" %}selected{% endif %}>
                {{ cat.nombre }}
            </option>
        {% endfor %}
    </select>

    <button type="submit">Filtrar</button>
</form>

<!-- Grilla de productos -->
<div class="productos-grid">
  {% for producto in productos %}
    <div class="producto-card">

        <!-- Imagen principal (clickeable al detalle) -->
        <a href="{% url 'detalle_producto' producto.id %}">
            {% if producto.imagen %}
                <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}">
            {% else %}
                <img src="https://via.placeholder.com/150" alt="Sin imagen">
            {% endif %}
        </a>

        <!-- Nombre clickeable al detalle -->
        <h3>
            <a href="{% url 'detalle_producto' producto.id %}">
                {{ producto.nombre }}
            </a>
        </h3>

        <p>{{ producto.descripcion|truncatewords:15 }}</p>
        <p><strong>${{ producto.precio }}</strong></p>

        {% if producto.stock == 0 %}
            <p class="sin-stock">Sin Stock</p>
            <a class="btn-carrito disabled">Agregar al carrito</a>
        {% elif producto.stock < 10 %}
            <p class="stock-bajo">Quedan solo {{ producto.stock }} unidades</p>
            <a class="btn-carrito" href="{% url 'agregar_al_carrito' producto.id %}">Agregar al carrito</a>
        {% else %}
            <a class="btn-carrito" href="{% url 'agregar_al_carrito' producto.id %}">Agregar al carrito</a>
        {% endif %}


    </div>
  {% empty %}
    <p>No hay productos disponibles.</p>
  {% endfor %}
</div>
{% endblock %}
