{% extends 'productos/base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'productos/detalle_producto.css' %}">
<style>
    .precio-original {
        text-decoration: line-through;
        color: #888;
        margin-right: 10px;
    }
    .precio-descuento {
        color: #28a745;
        font-size: 1.6rem;
        font-weight: bold;
    }
    .badge-descuento {
        background-color: #dc3545;
        color: #fff;
        font-size: 0.9rem;
        margin-left: 10px;
        padding: 4px 8px;
        border-radius: 5px;
    }
    .ahorro-texto {
        margin-top: 10px;
        font-size: 1rem;
        font-weight: bold;
        color: #ffc107;
    }
</style>
{% endblock %}

{% block content %}
<div class="detalle-producto container mt-4">
    <div class="row">
        <!-- Galer√≠a -->
        <div class="col-md-6 galeria">
            <img id="imagen-principal" 
                 class="imagen-principal" 
                 src="{% if producto.imagen %}{{ producto.imagen.url }}{% endif %}" 
                 alt="{{ producto.nombre }}">

            <div class="miniaturas">
                {% if producto.imagen %}
                    <img src="{{ producto.imagen.url }}" 
                         alt="Principal de {{ producto.nombre }}" 
                         class="miniatura active" 
                         onclick="cambiarImagen(this)">
                {% endif %}

                {% for img in producto.imagenes.all %}
                    <img src="{{ img.imagen.url }}" 
                         alt="Extra de {{ producto.nombre }}" 
                         class="miniatura" 
                         onclick="cambiarImagen(this)">
                {% endfor %}
            </div>
        </div>

        <!-- Info -->
        <div class="col-md-6">
            <h1>{{ producto.nombre }}</h1>

            {% if producto.descuento > 0 %}
                <p>
                    <span class="precio-original">${{ producto.precio }}</span>
                    <span class="precio-descuento">${{ producto.precio_con_descuento|floatformat:2 }}</span>
                    <span class="badge-descuento">-{{ producto.descuento }}%</span>
                </p>
                <p class="ahorro-texto">üí∞ Ahorr√°s ${{ producto.ahorro|floatformat:0 }}</p>
            {% else %}
                <p class="precio h4 text-success">${{ producto.precio }}</p>
            {% endif %}

            <p class="descripcion">{{ producto.descripcion }}</p>

            {% if producto.stock == 0 %}
                <p class="text-danger">‚ùå Sin Stock</p>
            {% elif producto.stock < 10 %}
                <p class="text-warning">‚ö† Quedan solo {{ producto.stock }} unidades</p>
            {% else %}
                <p class="text-success">‚úÖ Stock disponible</p>
            {% endif %}

            <a class="btn btn-primary mt-3" href="{% url 'agregar_al_carrito' producto.id %}">
                Agregar al carrito
            </a>
        </div>
    </div>
</div>

<script>
    function cambiarImagen(elemento) {
        const imagenPrincipal = document.getElementById("imagen-principal");
        imagenPrincipal.src = elemento.src;
        document.querySelectorAll(".miniaturas img").forEach(img => img.classList.remove("active"));
        elemento.classList.add("active");
    }
</script>
{% endblock %}
