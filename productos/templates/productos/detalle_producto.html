{% extends 'productos/base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'productos/detalle_producto.css' %}">
<style>
    .galeria {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .imagen-principal {
        max-width: 500px;
        height: auto;
        margin-bottom: 15px;
        border: 2px solid #ddd;
        border-radius: 8px;
        object-fit: contain;
    }

    .miniaturas {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
    }

    .miniaturas img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border: 2px solid transparent;
        border-radius: 6px;
        cursor: pointer;
        transition: 0.2s;
    }

    .miniaturas img:hover,
    .miniaturas img.active {
        border-color: #007bff;
        transform: scale(1.05);
    }
</style>
{% endblock %}

{% block content %}
<div class="detalle-producto container mt-4">
    <div class="row">
        <!-- Galería -->
        <div class="col-md-6 galeria">
            <!-- Imagen principal -->
            <img id="imagen-principal" 
                 class="imagen-principal" 
                 src="{% if producto.imagen %}{{ producto.imagen.url }}{% endif %}" 
                 alt="{{ producto.nombre }}">

            <!-- Miniaturas -->
            <div class="miniaturas">
                {% if producto.imagen %}
                    <img src="{{ producto.imagen.url }}" 
                         alt="Principal de {{ producto.nombre }}" 
                         class="miniatura active" 
                         onclick="cambiarImagen(this)">
                {% endif %}

                {% for img in producto.imagenes.all %}
                    <img src="{{ img.imagen.url }}" 
                         alt="Extra de {{ producto.nombre }}" 
                         class="miniatura" 
                         onclick="cambiarImagen(this)">
                {% endfor %}
            </div>
        </div>

        <!-- Info del producto -->
        <div class="col-md-6">
            <h1>{{ producto.nombre }}</h1>
            <p class="precio h4 text-success">${{ producto.precio }}</p>
            <p class="descripcion">{{ producto.descripcion }}</p>

            {% if producto.stock == 0 %}
                <p class="text-danger">❌ Sin Stock</p>
            {% elif producto.stock < 10 %}
                <p class="text-warning">⚠ Quedan solo {{ producto.stock }} unidades</p>
            {% else %}
                <p class="text-success">✅ Stock disponible</p>
            {% endif %}

            <a class="btn btn-primary mt-3" href="{% url 'agregar_al_carrito' producto.id %}">
                Agregar al carrito
            </a>
        </div>
    </div>
</div>

<!-- Script para cambiar imagen -->
<script>
    function cambiarImagen(elemento) {
        const imagenPrincipal = document.getElementById("imagen-principal");
        imagenPrincipal.src = elemento.src;

        // Quitar "active" de todas y asignar a la clickeada
        document.querySelectorAll(".miniaturas img").forEach(img => img.classList.remove("active"));
        elemento.classList.add("active");
    }
</script>
{% endblock %}
